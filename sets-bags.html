<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Diane Horton" />
  <title>5 Sets and Bags in SQL</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.line-block{white-space: pre-line;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://www.teach.cs.toronto.edu/~csc343h/fall/tufte.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">5 Sets and Bags in SQL</h1>
<p class="author">Diane Horton</p>
</header>
<section class="level1">
<p>Note: In these examples, we use SQL commands that have not been covered yet in the course, such as <code>CREATE TABLE</code> and <code>INSERT INTO</code>. We will learn about them shortly, and in fact you don’t need to understand these commands in any detail yet. Our goal here is to learn how and when duplicates can exist in a table, and can be returned by a query.</p>
<h2 id="tables-in-sql-can-have-duplicate-rows">Tables in SQL can have duplicate rows</h2>
<p>Let’s define a table Blah(x, y), with x as the primary key, and put some values into it:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb1-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">CREATE</span> <span class="kw">TABLE</span> Blah(x <span class="dt">INT</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span>, y <span class="dt">INT</span>);</a>
<a class="sourceLine" id="cb1-2" title="2">    NOTICE:  <span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="op">/</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> will <span class="kw">create</span> implicit <span class="kw">index</span> <span class="ot">&quot;blah_pkey&quot;</span> <span class="cf">for</span> <span class="kw">table</span> <span class="ot">&quot;blah&quot;</span></a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="kw">CREATE</span> <span class="kw">TABLE</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">INSERT</span> <span class="kw">INTO</span> Blah <span class="kw">VALUES</span> </a>
<a class="sourceLine" id="cb1-6" title="6">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="dv">1</span>, <span class="dv">3</span>), (<span class="dv">2</span>, <span class="dv">4</span>), (<span class="dv">7</span>, <span class="dv">9</span>), (<span class="dv">8</span>, <span class="dv">9</span>);</a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">INSERT</span> <span class="dv">0</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb1-8" title="8">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="op">*</span> </a>
<a class="sourceLine" id="cb1-9" title="9">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Blah;</a>
<a class="sourceLine" id="cb1-10" title="10">     x | y </a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="co">---+---</span></a>
<a class="sourceLine" id="cb1-12" title="12">     <span class="dv">1</span> | <span class="dv">3</span></a>
<a class="sourceLine" id="cb1-13" title="13">     <span class="dv">2</span> | <span class="dv">4</span></a>
<a class="sourceLine" id="cb1-14" title="14">     <span class="dv">7</span> | <span class="dv">9</span></a>
<a class="sourceLine" id="cb1-15" title="15">     <span class="dv">8</span> | <span class="dv">9</span></a>
<a class="sourceLine" id="cb1-16" title="16">    (<span class="dv">4</span> <span class="kw">rows</span>)</a></code></pre></div>
<p>Because <code>x</code> has been declared to be the primary key for table <code>Blah</code>, SQL will not allow any duplicate values for <code>x</code>, even if the rest of the row is different. Let’s confirm that SQL enforces this.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb2-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">INSERT</span> <span class="kw">INTO</span> Blah <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">88</span>);</a>
<a class="sourceLine" id="cb2-2" title="2">    ERROR:  duplicate <span class="kw">key</span> <span class="fu">value</span> violates <span class="kw">unique</span> <span class="kw">constraint</span> <span class="ot">&quot;blah_pkey&quot;</span></a></code></pre></div>
<p>It follows that we can’t repeat a whole row, because that would mean repeating the <code>x</code> values.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb3-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">INSERT</span> <span class="kw">INTO</span> Blah <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">3</span>);</a>
<a class="sourceLine" id="cb3-2" title="2">    ERROR:  duplicate <span class="kw">key</span> <span class="fu">value</span> violates <span class="kw">unique</span> <span class="kw">constraint</span> <span class="ot">&quot;blah_pkey&quot;</span></a></code></pre></div>
<p>So table <code>Blah</code> cannot have duplicate rows. But this is only due to having a primary key. In fact, SQL permits a table to have duplicate rows if this does not violate any constraint that has been defined. Here’s an example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb4-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- Here we define a table with no key.</span></a>
<a class="sourceLine" id="cb4-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">CREATE</span> <span class="kw">TABLE</span> Keyless (x <span class="dt">int</span>, y <span class="dt">int</span>);                     </a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="kw">CREATE</span> <span class="kw">TABLE</span></a>
<a class="sourceLine" id="cb4-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- Let&#39;s put the same values into it as the first table.</span></a>
<a class="sourceLine" id="cb4-5" title="5">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">INSERT</span> <span class="kw">INTO</span> Keyless <span class="kw">VALUES</span> </a>
<a class="sourceLine" id="cb4-6" title="6">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="dv">1</span>, <span class="dv">3</span>), (<span class="dv">2</span>, <span class="dv">4</span>), (<span class="dv">7</span>, <span class="dv">9</span>), (<span class="dv">8</span>, <span class="dv">9</span>);</a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="kw">INSERT</span> <span class="dv">0</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- (a) Now we can repeat an x-value!  No problem.</span></a>
<a class="sourceLine" id="cb4-10" title="10">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">INSERT</span> <span class="kw">INTO</span> Keyless <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">88</span>);</a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="kw">INSERT</span> <span class="dv">0</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb4-12" title="12">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> Keyless;</a>
<a class="sourceLine" id="cb4-13" title="13">     x | y  </a>
<a class="sourceLine" id="cb4-14" title="14">    <span class="co">---+----</span></a>
<a class="sourceLine" id="cb4-15" title="15">     <span class="dv">1</span> |  <span class="dv">3</span></a>
<a class="sourceLine" id="cb4-16" title="16">     <span class="dv">2</span> |  <span class="dv">4</span></a>
<a class="sourceLine" id="cb4-17" title="17">     <span class="dv">7</span> |  <span class="dv">9</span></a>
<a class="sourceLine" id="cb4-18" title="18">     <span class="dv">8</span> |  <span class="dv">9</span></a>
<a class="sourceLine" id="cb4-19" title="19">     <span class="dv">1</span> | <span class="dv">88</span></a>
<a class="sourceLine" id="cb4-20" title="20">    (<span class="dv">4</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb4-21" title="21">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- (b) We can repeat an entire row, in fact!</span></a>
<a class="sourceLine" id="cb4-22" title="22">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">INSERT</span> <span class="kw">INTO</span> Keyless <span class="kw">VALUES</span> (<span class="dv">1</span>, <span class="dv">3</span>);</a>
<a class="sourceLine" id="cb4-23" title="23">    <span class="kw">INSERT</span> <span class="dv">0</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb4-24" title="24">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span>  <span class="op">*</span> <span class="kw">FROM</span> Keyless;</a>
<a class="sourceLine" id="cb4-25" title="25">     x | y  </a>
<a class="sourceLine" id="cb4-26" title="26">    <span class="co">---+----</span></a>
<a class="sourceLine" id="cb4-27" title="27">     <span class="dv">1</span> |  <span class="dv">3</span></a>
<a class="sourceLine" id="cb4-28" title="28">     <span class="dv">2</span> |  <span class="dv">4</span></a>
<a class="sourceLine" id="cb4-29" title="29">     <span class="dv">7</span> |  <span class="dv">9</span></a>
<a class="sourceLine" id="cb4-30" title="30">     <span class="dv">1</span> | <span class="dv">88</span></a>
<a class="sourceLine" id="cb4-31" title="31">     <span class="dv">1</span> |  <span class="dv">3</span></a>
<a class="sourceLine" id="cb4-32" title="32">    (<span class="dv">5</span> <span class="kw">rows</span>)</a></code></pre></div>
<p>We have created a table that stores duplicate rows.</p>
<h2 id="tables-in-sql-are-bags">Tables in SQL are “bags”</h2>
<p>We can have duplicate rows because a table in SQL is not a set, it is a bag. In mathematics, a bag (also known as a “multiset”) is a generalization of the concept of a set; it allows duplicates. As with sets, order of the elements in a bag doesn’t matter, so {6, 2, 7, 2, 2, 1, 9} is the same bag as {1, 2, 2, 2, 6, 7, 9}, for example.</p>
<h2 id="select-from-where-queries-operate-under-bag-semantics">SELECT-FROM-WHERE queries operate under bag semantics</h2>
<p>Even with a table that has a primary key (and therefore can’t have duplicate rows), we can write a query that will yield duplicate rows.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb5-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- Recall the table Blah from above, with primary key x.</span></a>
<a class="sourceLine" id="cb5-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb5-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Blah;</a>
<a class="sourceLine" id="cb5-4" title="4">     x | y </a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="co">---+---</span></a>
<a class="sourceLine" id="cb5-6" title="6">     <span class="dv">1</span> | <span class="dv">3</span></a>
<a class="sourceLine" id="cb5-7" title="7">     <span class="dv">2</span> | <span class="dv">4</span></a>
<a class="sourceLine" id="cb5-8" title="8">     <span class="dv">7</span> | <span class="dv">9</span></a>
<a class="sourceLine" id="cb5-9" title="9">     <span class="dv">8</span> | <span class="dv">9</span></a>
<a class="sourceLine" id="cb5-10" title="10">    (<span class="dv">4</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- Blah has no duplicate rows, because it can&#39;t even repeat</span></a>
<a class="sourceLine" id="cb5-13" title="13">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- an x-value, due to its key.  But the following query on Blah</span></a>
<a class="sourceLine" id="cb5-14" title="14">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- reports a result with duplicate rows:</span></a>
<a class="sourceLine" id="cb5-15" title="15">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> y</a>
<a class="sourceLine" id="cb5-16" title="16">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Blah;</a>
<a class="sourceLine" id="cb5-17" title="17">     y </a>
<a class="sourceLine" id="cb5-18" title="18">    <span class="co">---</span></a>
<a class="sourceLine" id="cb5-19" title="19">     <span class="dv">3</span></a>
<a class="sourceLine" id="cb5-20" title="20">     <span class="dv">4</span></a>
<a class="sourceLine" id="cb5-21" title="21">     <span class="dv">9</span></a>
<a class="sourceLine" id="cb5-22" title="22">     <span class="dv">9</span></a>
<a class="sourceLine" id="cb5-23" title="23">    (<span class="dv">4</span> <span class="kw">rows</span>)</a></code></pre></div>
<p><code>SELECT-FROM-WHERE</code> statements leave duplicate rows by default. We say that they work under bag semantics. You may wonder why. One reason is that we may want the duplicates in the result because they tell us how many times something occurred. In addition, getting rid of duplicates is expensive! Imagine you have a table with n rows and you have to turn it from a bag into a set. How much work would that be? Now remember that n might be 100,000. SQL doesn’t do the work of duplicate elimination unless we explictly ask for it.</p>
<h2 id="we-can-override-the-default">We can override the default</h2>
<p>The keyword <code>DISTINCT</code> can be used to override the default behaviour of SELECT-FROM-WHERE queries and eliminate duplicates.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb6-1" title="1">    <span class="co">-- A query with duplicate results</span></a>
<a class="sourceLine" id="cb6-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="kw">oid</span></a>
<a class="sourceLine" id="cb6-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took</a>
<a class="sourceLine" id="cb6-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span>;</a>
<a class="sourceLine" id="cb6-5" title="5">     <span class="kw">oid</span> </a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="co">-----</span></a>
<a class="sourceLine" id="cb6-7" title="7">      <span class="dv">16</span></a>
<a class="sourceLine" id="cb6-8" title="8">      <span class="dv">11</span></a>
<a class="sourceLine" id="cb6-9" title="9">      <span class="dv">13</span></a>
<a class="sourceLine" id="cb6-10" title="10">      <span class="dv">39</span></a>
<a class="sourceLine" id="cb6-11" title="11">      <span class="dv">11</span></a>
<a class="sourceLine" id="cb6-12" title="12">      <span class="dv">13</span></a>
<a class="sourceLine" id="cb6-13" title="13">      <span class="dv">16</span></a>
<a class="sourceLine" id="cb6-14" title="14">      <span class="dv">22</span></a>
<a class="sourceLine" id="cb6-15" title="15">       <span class="dv">1</span></a>
<a class="sourceLine" id="cb6-16" title="16">      <span class="dv">14</span></a>
<a class="sourceLine" id="cb6-17" title="17">    (<span class="dv">10</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb6-18" title="18"></a>
<a class="sourceLine" id="cb6-19" title="19">    <span class="co">-- Order the results so we can see the duplicates more clearly.</span></a>
<a class="sourceLine" id="cb6-20" title="20">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="kw">oid</span> </a>
<a class="sourceLine" id="cb6-21" title="21">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took</a>
<a class="sourceLine" id="cb6-22" title="22">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span></a>
<a class="sourceLine" id="cb6-23" title="23">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">oid</span>;</a>
<a class="sourceLine" id="cb6-24" title="24">     <span class="kw">oid</span> </a>
<a class="sourceLine" id="cb6-25" title="25">    <span class="co">-----</span></a>
<a class="sourceLine" id="cb6-26" title="26">       <span class="dv">1</span></a>
<a class="sourceLine" id="cb6-27" title="27">      <span class="dv">11</span></a>
<a class="sourceLine" id="cb6-28" title="28">      <span class="dv">11</span></a>
<a class="sourceLine" id="cb6-29" title="29">      <span class="dv">13</span></a>
<a class="sourceLine" id="cb6-30" title="30">      <span class="dv">13</span></a>
<a class="sourceLine" id="cb6-31" title="31">      <span class="dv">14</span></a>
<a class="sourceLine" id="cb6-32" title="32">      <span class="dv">16</span></a>
<a class="sourceLine" id="cb6-33" title="33">      <span class="dv">16</span></a>
<a class="sourceLine" id="cb6-34" title="34">      <span class="dv">22</span></a>
<a class="sourceLine" id="cb6-35" title="35">      <span class="dv">39</span></a>
<a class="sourceLine" id="cb6-36" title="36">    (<span class="dv">10</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb6-37" title="37"></a>
<a class="sourceLine" id="cb6-38" title="38">    <span class="co">-- Introduce DISTINCT to say we don&#39;t want the duplicates.</span></a>
<a class="sourceLine" id="cb6-39" title="39">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">oid</span> </a>
<a class="sourceLine" id="cb6-40" title="40">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took</a>
<a class="sourceLine" id="cb6-41" title="41">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span> </a>
<a class="sourceLine" id="cb6-42" title="42">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">oid</span>;</a>
<a class="sourceLine" id="cb6-43" title="43">     <span class="kw">oid</span> </a>
<a class="sourceLine" id="cb6-44" title="44">    <span class="co">-----</span></a>
<a class="sourceLine" id="cb6-45" title="45">       <span class="dv">1</span></a>
<a class="sourceLine" id="cb6-46" title="46">      <span class="dv">11</span></a>
<a class="sourceLine" id="cb6-47" title="47">      <span class="dv">13</span></a>
<a class="sourceLine" id="cb6-48" title="48">      <span class="dv">14</span></a>
<a class="sourceLine" id="cb6-49" title="49">      <span class="dv">16</span></a>
<a class="sourceLine" id="cb6-50" title="50">      <span class="dv">22</span></a>
<a class="sourceLine" id="cb6-51" title="51">      <span class="dv">39</span></a>
<a class="sourceLine" id="cb6-52" title="52">    (<span class="dv">7</span> <span class="kw">rows</span>)</a></code></pre></div>
<h2 id="we-can-only-ask-for-distinct-rows-overall-not-by-column">We can only ask for distinct rows overall, not by column</h2>
<p>Consider the different kinds of duplication in this query’s result:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb7-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="kw">oid</span>, grade</a>
<a class="sourceLine" id="cb7-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took</a>
<a class="sourceLine" id="cb7-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span></a>
<a class="sourceLine" id="cb7-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">oid</span>;</a>
<a class="sourceLine" id="cb7-5" title="5">     <span class="kw">oid</span> | grade </a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="co">-----+-------</span></a>
<a class="sourceLine" id="cb7-7" title="7">       <span class="dv">1</span> |    <span class="dv">99</span></a>
<a class="sourceLine" id="cb7-8" title="8">      <span class="dv">11</span> |    <span class="dv">99</span>          <span class="op">&lt;</span><span class="co">-- (a) These rows are duplicates</span></a>
<a class="sourceLine" id="cb7-9" title="9">      <span class="dv">11</span> |    <span class="dv">99</span>          <span class="op">&lt;</span><span class="co">-- (same oid and same grade)</span></a>
<a class="sourceLine" id="cb7-10" title="10">      <span class="dv">13</span> |    <span class="dv">99</span></a>
<a class="sourceLine" id="cb7-11" title="11">      <span class="dv">13</span> |    <span class="dv">98</span>          <span class="op">&lt;</span><span class="co">-- (b) These rows have the same grade,</span></a>
<a class="sourceLine" id="cb7-12" title="12">      <span class="dv">14</span> |    <span class="dv">98</span>          <span class="op">&lt;</span><span class="co">-- but different oids.</span></a>
<a class="sourceLine" id="cb7-13" title="13">      <span class="dv">16</span> |   <span class="dv">100</span>          <span class="op">&lt;</span><span class="co">-- (c) These rows have the same oid,</span></a>
<a class="sourceLine" id="cb7-14" title="14">      <span class="dv">16</span> |    <span class="dv">98</span>          <span class="op">&lt;</span><span class="co">-- but different grades</span></a>
<a class="sourceLine" id="cb7-15" title="15">      <span class="dv">22</span> |    <span class="dv">96</span></a>
<a class="sourceLine" id="cb7-16" title="16">      <span class="dv">39</span> |    <span class="dv">97</span></a>
<a class="sourceLine" id="cb7-17" title="17">    (<span class="dv">10</span> <span class="kw">rows</span>)</a></code></pre></div>
<p>The duplicates in column oid occur in different rows than the duplicates in column grade, So SQL won’t let us write a query that asks for both columns to be distinct.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb8-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">oid</span>, <span class="kw">DISTINCT</span> grade </a>
<a class="sourceLine" id="cb8-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took </a>
<a class="sourceLine" id="cb8-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span> </a>
<a class="sourceLine" id="cb8-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">oid</span>; </a>
<a class="sourceLine" id="cb8-5" title="5">    ERROR:  syntax error <span class="kw">at</span> <span class="kw">or</span> near <span class="ot">&quot;DISTINCT&quot;</span></a>
<a class="sourceLine" id="cb8-6" title="6">    LINE <span class="dv">1</span>: <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">oid</span>, <span class="kw">DISTINCT</span> grade <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="op">..</span>.</a>
<a class="sourceLine" id="cb8-7" title="7">                                 ^</a></code></pre></div>
<p><code>DISTINCT</code> actually works at the level of the row, not individual cells. It turns the result of the query into a set, rather than a bag. So we can only say <code>DISTINCT</code> once, right before we list the columns that we want in the result.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb9-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- This query, with one DISTINCT before the column list, </span></a>
<a class="sourceLine" id="cb9-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- works:</span></a>
<a class="sourceLine" id="cb9-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="kw">DISTINCT</span> <span class="kw">oid</span>, grade</a>
<a class="sourceLine" id="cb9-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took</a>
<a class="sourceLine" id="cb9-5" title="5">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span></a>
<a class="sourceLine" id="cb9-6" title="6">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">oid</span>;</a>
<a class="sourceLine" id="cb9-7" title="7">     <span class="kw">oid</span> | grade </a>
<a class="sourceLine" id="cb9-8" title="8">    <span class="co">-----+-------</span></a>
<a class="sourceLine" id="cb9-9" title="9">       <span class="dv">1</span> |    <span class="dv">99</span></a>
<a class="sourceLine" id="cb9-10" title="10">      <span class="dv">11</span> |    <span class="dv">99</span></a>
<a class="sourceLine" id="cb9-11" title="11">      <span class="dv">13</span> |    <span class="dv">98</span></a>
<a class="sourceLine" id="cb9-12" title="12">      <span class="dv">13</span> |    <span class="dv">99</span></a>
<a class="sourceLine" id="cb9-13" title="13">      <span class="dv">14</span> |    <span class="dv">98</span></a>
<a class="sourceLine" id="cb9-14" title="14">      <span class="dv">16</span> |    <span class="dv">98</span></a>
<a class="sourceLine" id="cb9-15" title="15">      <span class="dv">16</span> |   <span class="dv">100</span></a>
<a class="sourceLine" id="cb9-16" title="16">      <span class="dv">22</span> |    <span class="dv">96</span></a>
<a class="sourceLine" id="cb9-17" title="17">      <span class="dv">39</span> |    <span class="dv">97</span></a>
<a class="sourceLine" id="cb9-18" title="18">    (<span class="dv">9</span> <span class="kw">rows</span>)</a></code></pre></div>
<p>Notice that we have 9 rows now rather than 10. The <code>DISTINCT</code> removed the the entirely repeated rows, marked (a) above. The partial duplications were not removed.</p>
<h2 id="aside-the-other-place-where-distinct-can-go">Aside: The other place where DISTINCT can go</h2>
<p>Above, we used DISTINCT outside of any aggregation. We have seen DISTINCT before, <em>inside</em> the brackets on an aggregation, for example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb10-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="fu">count</span>(<span class="kw">DISTINCT</span> sid)</a>
<a class="sourceLine" id="cb10-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took;</a>
<a class="sourceLine" id="cb10-3" title="3">     <span class="fu">count</span> </a>
<a class="sourceLine" id="cb10-4" title="4">    <span class="co">-------</span></a>
<a class="sourceLine" id="cb10-5" title="5">         <span class="dv">5</span></a>
<a class="sourceLine" id="cb10-6" title="6">    (<span class="dv">1</span> <span class="kw">row</span>)</a></code></pre></div>
<p>With DISTINCT in this context, we <em>can</em> use it more than once in the same query.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb11-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="fu">count</span>(<span class="kw">DISTINCT</span> sid), <span class="fu">count</span>(<span class="kw">distinct</span> <span class="kw">oid</span>)</a>
<a class="sourceLine" id="cb11-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took;</a>
<a class="sourceLine" id="cb11-3" title="3">     <span class="fu">count</span> | <span class="fu">count</span> </a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="co">-------+-------</span></a>
<a class="sourceLine" id="cb11-5" title="5">         <span class="dv">5</span> |    <span class="dv">23</span></a>
<a class="sourceLine" id="cb11-6" title="6">    (<span class="dv">1</span> <span class="kw">row</span>)</a></code></pre></div>
<h2 id="sql-offers-set-union-intersection-and-difference">SQL offers set union, intersection and difference</h2>
<p>With all this talk about sets, you may be wondering about the set operators you know. SQL offers union, intersection and difference:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb12-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- Set union:</span></a>
<a class="sourceLine" id="cb12-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> sid, grade <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span>)</a>
<a class="sourceLine" id="cb12-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">UNION</span></a>
<a class="sourceLine" id="cb12-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> sid, grade <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&lt;</span> <span class="dv">50</span>);</a>
<a class="sourceLine" id="cb12-5" title="5">      sid  | grade </a>
<a class="sourceLine" id="cb12-6" title="6">    <span class="co">-------+-------</span></a>
<a class="sourceLine" id="cb12-7" title="7">     <span class="dv">11111</span> |    <span class="dv">40</span></a>
<a class="sourceLine" id="cb12-8" title="8">     <span class="dv">99999</span> |    <span class="dv">96</span></a>
<a class="sourceLine" id="cb12-9" title="9">     <span class="dv">99132</span> |    <span class="dv">39</span></a>
<a class="sourceLine" id="cb12-10" title="10">       <span class="dv">157</span> |    <span class="dv">99</span></a>
<a class="sourceLine" id="cb12-11" title="11">     <span class="dv">99999</span> |   <span class="dv">100</span></a>
<a class="sourceLine" id="cb12-12" title="12">     <span class="dv">11111</span> |    <span class="dv">45</span></a>
<a class="sourceLine" id="cb12-13" title="13">     <span class="dv">98000</span> |    <span class="dv">98</span></a>
<a class="sourceLine" id="cb12-14" title="14">     <span class="dv">11111</span> |    <span class="dv">46</span></a>
<a class="sourceLine" id="cb12-15" title="15">     <span class="dv">11111</span> |    <span class="dv">17</span></a>
<a class="sourceLine" id="cb12-16" title="16">     <span class="dv">99132</span> |    <span class="dv">98</span></a>
<a class="sourceLine" id="cb12-17" title="17">     <span class="dv">11111</span> |     <span class="dv">0</span></a>
<a class="sourceLine" id="cb12-18" title="18">       <span class="dv">157</span> |    <span class="dv">39</span></a>
<a class="sourceLine" id="cb12-19" title="19">     <span class="dv">99132</span> |    <span class="dv">99</span></a>
<a class="sourceLine" id="cb12-20" title="20">     <span class="dv">98000</span> |    <span class="dv">97</span></a>
<a class="sourceLine" id="cb12-21" title="21">       <span class="dv">157</span> |    <span class="dv">98</span></a>
<a class="sourceLine" id="cb12-22" title="22">     <span class="dv">99999</span> |    <span class="dv">99</span></a>
<a class="sourceLine" id="cb12-23" title="23">    (<span class="dv">16</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb12-24" title="24"></a>
<a class="sourceLine" id="cb12-25" title="25">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- Set intersection:</span></a>
<a class="sourceLine" id="cb12-26" title="26">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span>)</a>
<a class="sourceLine" id="cb12-27" title="27">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">INTERSECT</span></a>
<a class="sourceLine" id="cb12-28" title="28">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&lt;</span> <span class="dv">50</span>);</a>
<a class="sourceLine" id="cb12-29" title="29">      sid  </a>
<a class="sourceLine" id="cb12-30" title="30">    <span class="co">-------</span></a>
<a class="sourceLine" id="cb12-31" title="31">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb12-32" title="32">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb12-33" title="33">    (<span class="dv">2</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb12-34" title="34"></a>
<a class="sourceLine" id="cb12-35" title="35">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- Set difference:</span></a>
<a class="sourceLine" id="cb12-36" title="36">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span>)</a>
<a class="sourceLine" id="cb12-37" title="37">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">EXCEPT</span>   </a>
<a class="sourceLine" id="cb12-38" title="38">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&lt;</span> <span class="dv">50</span>);</a>
<a class="sourceLine" id="cb12-39" title="39">      sid  </a>
<a class="sourceLine" id="cb12-40" title="40">    <span class="co">-------</span></a>
<a class="sourceLine" id="cb12-41" title="41">     <span class="dv">98000</span></a>
<a class="sourceLine" id="cb12-42" title="42">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb12-43" title="43">    (<span class="dv">2</span> <span class="kw">rows</span>)</a></code></pre></div>
<p>There are two important syntactic requirements to notice:</p>
<ul>
<li>An operand to a set operator must be surrounded by round brackets.</li>
<li>An operand to a set operator must be a complete query. For instance, if we wanted to intersect tables Elephant and Flower, we couldn’t just write <code>(Elephant) INTERSECT (Flower);</code> Instead we would have to write <code>(SELECT * FROM Elephant) INTERSECT (SELECT * FROM Flower);</code></li>
</ul>
<h2 id="set-operators-require-compatible-schemas">Set operators require compatible schemas</h2>
<p>As you probably expect, the two operands to a set operator must have compatible schemas. In the following example, <code>sid</code> is an integer and <code>instructor</code> is a kind of string (a <code>VARCHAR(40)</code> to be precise), so the query fails:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb13-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took)</a>
<a class="sourceLine" id="cb13-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">UNION</span></a>
<a class="sourceLine" id="cb13-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> instructor <span class="kw">FROM</span> Offering); </a>
<a class="sourceLine" id="cb13-4" title="4">    ERROR:  <span class="kw">UNION</span> <span class="kw">types</span> <span class="dt">integer</span> <span class="kw">and</span> <span class="dt">character</span> <span class="dt">varying</span> cannot be matched</a>
<a class="sourceLine" id="cb13-5" title="5">    LINE <span class="dv">1</span>: (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took) <span class="kw">UNION</span> (<span class="kw">SELECT</span> instructor <span class="kw">FROM</span> Offerin<span class="op">..</span>.</a>
<a class="sourceLine" id="cb13-6" title="6">                                                 ^</a></code></pre></div>
<p>What exactly is considered compatible will vary from DBMS to DBMS. Postgresql will, for instance accept these queries, but another DBMS may not:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb14-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- sid and oid are both of type integer, but the</span></a>
<a class="sourceLine" id="cb14-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- column names are not the same:</span></a>
<a class="sourceLine" id="cb14-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took)</a>
<a class="sourceLine" id="cb14-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">UNION</span></a>
<a class="sourceLine" id="cb14-5" title="5">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> <span class="kw">oid</span> <span class="kw">FROM</span> Took);</a>
<a class="sourceLine" id="cb14-6" title="6">      sid  </a>
<a class="sourceLine" id="cb14-7" title="7">    <span class="co">-------</span></a>
<a class="sourceLine" id="cb14-8" title="8">     <span class="dv">98000</span></a>
<a class="sourceLine" id="cb14-9" title="9">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb14-10" title="10">         <span class="dv">8</span></a>
<a class="sourceLine" id="cb14-11" title="11">        <span class="dv">11</span></a>
<a class="sourceLine" id="cb14-12" title="12">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb14-13" title="13">        <span class="dv">16</span></a>
<a class="sourceLine" id="cb14-14" title="14">        <span class="dv">39</span></a>
<a class="sourceLine" id="cb14-15" title="15">         <span class="dv">3</span></a>
<a class="sourceLine" id="cb14-16" title="16">        <span class="dv">14</span></a>
<a class="sourceLine" id="cb14-17" title="17">        <span class="dv">17</span></a>
<a class="sourceLine" id="cb14-18" title="18">        <span class="dv">28</span></a>
<a class="sourceLine" id="cb14-19" title="19">        <span class="dv">15</span></a>
<a class="sourceLine" id="cb14-20" title="20">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb14-21" title="21">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb14-22" title="22">        <span class="dv">31</span></a>
<a class="sourceLine" id="cb14-23" title="23">        <span class="dv">35</span></a>
<a class="sourceLine" id="cb14-24" title="24">        <span class="dv">34</span></a>
<a class="sourceLine" id="cb14-25" title="25">         <span class="dv">1</span></a>
<a class="sourceLine" id="cb14-26" title="26">        <span class="dv">26</span></a>
<a class="sourceLine" id="cb14-27" title="27">        <span class="dv">13</span></a>
<a class="sourceLine" id="cb14-28" title="28">        <span class="dv">22</span></a>
<a class="sourceLine" id="cb14-29" title="29">         <span class="dv">9</span></a>
<a class="sourceLine" id="cb14-30" title="30">        <span class="dv">27</span></a>
<a class="sourceLine" id="cb14-31" title="31">        <span class="dv">38</span></a>
<a class="sourceLine" id="cb14-32" title="32">         <span class="dv">6</span></a>
<a class="sourceLine" id="cb14-33" title="33">        <span class="dv">21</span></a>
<a class="sourceLine" id="cb14-34" title="34">         <span class="dv">5</span></a>
<a class="sourceLine" id="cb14-35" title="35">         <span class="dv">7</span></a>
<a class="sourceLine" id="cb14-36" title="36">    (<span class="dv">28</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb14-37" title="37"></a>
<a class="sourceLine" id="cb14-38" title="38">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- And here in table Offering, column &#39;name&#39; is of type </span></a>
<a class="sourceLine" id="cb14-39" title="39">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- varchar(40), while &#39;dept&#39; is of a user-defined type which</span></a>
<a class="sourceLine" id="cb14-40" title="40">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- is a restriction on varchar(20).</span></a>
<a class="sourceLine" id="cb14-41" title="41">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> name <span class="kw">FROM</span> Course)</a>
<a class="sourceLine" id="cb14-42" title="42">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">UNION</span></a>
<a class="sourceLine" id="cb14-43" title="43">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> dept <span class="kw">FROM</span> Course);</a>
<a class="sourceLine" id="cb14-44" title="44"></a>
<a class="sourceLine" id="cb14-45" title="45">                  name              </a>
<a class="sourceLine" id="cb14-46" title="46">    <span class="co">--------------------------------</span></a>
<a class="sourceLine" id="cb14-47" title="47">     Human Biol &amp; Evol</a>
<a class="sourceLine" id="cb14-48" title="48">     Mediaeval Society</a>
<a class="sourceLine" id="cb14-49" title="49">     CSC <span class="cf">for</span> future prime ministers</a>
<a class="sourceLine" id="cb14-50" title="50">     Environmental <span class="kw">Change</span></a>
<a class="sourceLine" id="cb14-51" title="51">     Intro Archaeology</a>
<a class="sourceLine" id="cb14-52" title="52">     Intro <span class="kw">to</span> Databases</a>
<a class="sourceLine" id="cb14-53" title="53">     Organisms <span class="kw">in</span> Environ</a>
<a class="sourceLine" id="cb14-54" title="54">     <span class="kw">Data</span> Struct &amp; Anal</a>
<a class="sourceLine" id="cb14-55" title="55">     ENV</a>
<a class="sourceLine" id="cb14-56" title="56">     EEB</a>
<a class="sourceLine" id="cb14-57" title="57">     Black Freedom</a>
<a class="sourceLine" id="cb14-58" title="58">     Natl &amp; Intl Env Policy</a>
<a class="sourceLine" id="cb14-59" title="59">     ANT</a>
<a class="sourceLine" id="cb14-60" title="60">     HIS</a>
<a class="sourceLine" id="cb14-61" title="61">     <span class="kw">The</span> Graphic Novel</a>
<a class="sourceLine" id="cb14-62" title="62">     COBOL programming</a>
<a class="sourceLine" id="cb14-63" title="63">     Compar Vert Anatomy</a>
<a class="sourceLine" id="cb14-64" title="64">     CSC</a>
<a class="sourceLine" id="cb14-65" title="65">     ENG</a>
<a class="sourceLine" id="cb14-66" title="66">     Narrative</a>
<a class="sourceLine" id="cb14-67" title="67">     Intro <span class="kw">to</span> Comp Sci</a>
<a class="sourceLine" id="cb14-68" title="68">     Intro <span class="kw">to</span> Visual Computing</a>
<a class="sourceLine" id="cb14-69" title="69">     Rhetoric</a>
<a class="sourceLine" id="cb14-70" title="70">     Software Design</a>
<a class="sourceLine" id="cb14-71" title="71">     Marine Mammal Bio</a>
<a class="sourceLine" id="cb14-72" title="72">    (<span class="dv">25</span> <span class="kw">rows</span>)</a></code></pre></div>
<h2 id="set-operators-work-under-set-semantics">Set operators work under set semantics</h2>
<p>We saw earlier that <code>SELECT-FROM-WHERE</code> queries work under bag semantics. In contrast, the set operators work under set semantics. Here’s an example to demonstrate.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb15-1" title="1">    <span class="co">-- Here are two SELECT-FROM-WHERE queries that we&#39;ll union together in a moment.</span></a>
<a class="sourceLine" id="cb15-2" title="2">    <span class="co">-- The first one has duplicates (and they&#39;re left in because SELECT-FROM-WHERE</span></a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="co">-- uses bag semantics by default).</span></a>
<a class="sourceLine" id="cb15-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> sid</a>
<a class="sourceLine" id="cb15-5" title="5">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took</a>
<a class="sourceLine" id="cb15-6" title="6">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span>;</a>
<a class="sourceLine" id="cb15-7" title="7">      sid  </a>
<a class="sourceLine" id="cb15-8" title="8">    <span class="co">-------</span></a>
<a class="sourceLine" id="cb15-9" title="9">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb15-10" title="10">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb15-11" title="11">     <span class="dv">98000</span></a>
<a class="sourceLine" id="cb15-12" title="12">     <span class="dv">98000</span></a>
<a class="sourceLine" id="cb15-13" title="13">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb15-14" title="14">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb15-15" title="15">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb15-16" title="16">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb15-17" title="17">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb15-18" title="18">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb15-19" title="19">    (<span class="dv">10</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb15-20" title="20"></a>
<a class="sourceLine" id="cb15-21" title="21">    <span class="co">-- The second query has duplicates too.</span></a>
<a class="sourceLine" id="cb15-22" title="22">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> sid</a>
<a class="sourceLine" id="cb15-23" title="23">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Took</a>
<a class="sourceLine" id="cb15-24" title="24">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">WHERE</span> grade <span class="op">&lt;</span> <span class="dv">50</span>;</a>
<a class="sourceLine" id="cb15-25" title="25">      sid  </a>
<a class="sourceLine" id="cb15-26" title="26">    <span class="co">-------</span></a>
<a class="sourceLine" id="cb15-27" title="27">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb15-28" title="28">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb15-29" title="29">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb15-30" title="30">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb15-31" title="31">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb15-32" title="32">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb15-33" title="33">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb15-34" title="34">    (<span class="dv">7</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb15-35" title="35"></a>
<a class="sourceLine" id="cb15-36" title="36">    <span class="co">-- But when we do union, we don&#39;t get all 17 rows.  The duplicates are </span></a>
<a class="sourceLine" id="cb15-37" title="37">    <span class="co">-- eliminated, by default.</span></a>
<a class="sourceLine" id="cb15-38" title="38">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span>) </a>
<a class="sourceLine" id="cb15-39" title="39">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">UNION</span></a>
<a class="sourceLine" id="cb15-40" title="40">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&lt;</span> <span class="dv">50</span>);</a>
<a class="sourceLine" id="cb15-41" title="41">      sid  </a>
<a class="sourceLine" id="cb15-42" title="42">    <span class="co">-------</span></a>
<a class="sourceLine" id="cb15-43" title="43">     <span class="dv">98000</span></a>
<a class="sourceLine" id="cb15-44" title="44">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb15-45" title="45">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb15-46" title="46">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb15-47" title="47">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb15-48" title="48">    (<span class="dv">5</span> <span class="kw">rows</span>)</a></code></pre></div>
<h2 id="we-can-override-the-default-1">We can override the default</h2>
<p>We just saw that the set operators use set semantics by default. We can override this with the keyword <code>ALL</code>. In that case, bag semantics are used, meaning that duplicates are <em>not</em> eliminated.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb16-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- UNION ALL says we want the duplicates.  Now we get </span></a>
<a class="sourceLine" id="cb16-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="co">-- all 17 rows.</span></a>
<a class="sourceLine" id="cb16-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&gt;</span> <span class="dv">95</span>) </a>
<a class="sourceLine" id="cb16-4" title="4">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">UNION</span> <span class="kw">ALL</span></a>
<a class="sourceLine" id="cb16-5" title="5">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> sid <span class="kw">FROM</span> Took <span class="kw">WHERE</span> grade <span class="op">&lt;</span> <span class="dv">50</span>);</a>
<a class="sourceLine" id="cb16-6" title="6">      sid  </a>
<a class="sourceLine" id="cb16-7" title="7">    <span class="co">-------</span></a>
<a class="sourceLine" id="cb16-8" title="8">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb16-9" title="9">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb16-10" title="10">     <span class="dv">98000</span></a>
<a class="sourceLine" id="cb16-11" title="11">     <span class="dv">98000</span></a>
<a class="sourceLine" id="cb16-12" title="12">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb16-13" title="13">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb16-14" title="14">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb16-15" title="15">     <span class="dv">99999</span></a>
<a class="sourceLine" id="cb16-16" title="16">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb16-17" title="17">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb16-18" title="18">     <span class="dv">99132</span></a>
<a class="sourceLine" id="cb16-19" title="19">       <span class="dv">157</span></a>
<a class="sourceLine" id="cb16-20" title="20">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb16-21" title="21">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb16-22" title="22">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb16-23" title="23">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb16-24" title="24">     <span class="dv">11111</span></a>
<a class="sourceLine" id="cb16-25" title="25">    (<span class="dv">17</span> <span class="kw">rows</span>)</a></code></pre></div>
<h2 id="the-meaning-of-bag-union-intersection-and-difference">The meaning of bag union, intersection and difference</h2>
<p>The exact result of a union, intersection, or difference under bag semantics requires some thought. (But it makes total sense.)</p>
<p>For union, you can imagine two bags full of marbles. You might have a red marble, even several red marbles, in each bag. The union of the two bags is just what you get when you dump them together. So, mathematically, {1, 1, 1, 3, 7, 7, 8} ∪ {1, 5, 7, 7, 8, 8} = {1, 1, 1, 1, 3, 5, 7, 7, 7, 7, 8, 8, 8}. For intersection and difference, think of matching up individual elements across the bags. {1, 1, 1, 3, 7, 7, 8} ∩ {1, 5, 7, 7, 8, 8} = {1, 7, 7, 8} and {1, 1, 1, 3, 7, 7, 8} − {1, 5, 7, 7, 8, 8} = {1, 1, 3} For this last case (difference with bags), you take each marble from the second bag and if you can, remove a matching marble from the first. The result is what is left in the first bag.</p>
<h2 id="a-special-note-about-except-all">A special note about EXCEPT ALL</h2>
<p>Whether we use <code>EXCEPT</code> or <code>EXCEPT ALL</code> determines not only how many times a row occurs in the result, but whether or not it occurs at all.</p>
<p>Suppose we have tables P and Q with these contents:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb17-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb17-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> P;</a>
<a class="sourceLine" id="cb17-3" title="3">     a |  b  </a>
<a class="sourceLine" id="cb17-4" title="4">    <span class="co">---+-----</span></a>
<a class="sourceLine" id="cb17-5" title="5">     <span class="dv">1</span> | <span class="dv">151</span></a>
<a class="sourceLine" id="cb17-6" title="6">     <span class="dv">2</span> | <span class="dv">123</span></a>
<a class="sourceLine" id="cb17-7" title="7">     <span class="dv">3</span> | <span class="dv">432</span></a>
<a class="sourceLine" id="cb17-8" title="8">     <span class="dv">1</span> | <span class="dv">333</span></a>
<a class="sourceLine" id="cb17-9" title="9">     <span class="dv">1</span> | <span class="dv">345</span></a>
<a class="sourceLine" id="cb17-10" title="10">     <span class="dv">4</span> | <span class="dv">912</span></a>
<a class="sourceLine" id="cb17-11" title="11">     <span class="dv">5</span> | <span class="dv">123</span></a>
<a class="sourceLine" id="cb17-12" title="12">    (<span class="dv">7</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb17-13" title="13"></a>
<a class="sourceLine" id="cb17-14" title="14">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> <span class="kw">SELECT</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb17-15" title="15">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">FROM</span> Q;</a>
<a class="sourceLine" id="cb17-16" title="16">     a | c  </a>
<a class="sourceLine" id="cb17-17" title="17">    <span class="co">---+----</span></a>
<a class="sourceLine" id="cb17-18" title="18">     <span class="dv">1</span> | <span class="dv">44</span></a>
<a class="sourceLine" id="cb17-19" title="19">     <span class="dv">3</span> | <span class="dv">88</span></a>
<a class="sourceLine" id="cb17-20" title="20">     <span class="dv">3</span> | <span class="dv">12</span></a>
<a class="sourceLine" id="cb17-21" title="21">     <span class="dv">9</span> | <span class="dv">12</span></a>
<a class="sourceLine" id="cb17-22" title="22">    (<span class="dv">4</span> <span class="kw">rows</span>)</a></code></pre></div>
<p>With EXCEPT ALL, we match values up individually. For example, when we remove the one 1 that we get out of Q from the three 1s that we get out of P, there are two 1s left.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb18-1" title="1">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> a <span class="kw">FROM</span> P) </a>
<a class="sourceLine" id="cb18-2" title="2">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">EXCEPT</span> <span class="kw">ALL</span></a>
<a class="sourceLine" id="cb18-3" title="3">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> a <span class="kw">FROM</span> Q);</a>
<a class="sourceLine" id="cb18-4" title="4">     a </a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="co">---</span></a>
<a class="sourceLine" id="cb18-6" title="6">     <span class="dv">1</span>                <span class="op">&lt;</span><span class="co">-- There are two 1s in this result</span></a>
<a class="sourceLine" id="cb18-7" title="7">     <span class="dv">1</span></a>
<a class="sourceLine" id="cb18-8" title="8">     <span class="dv">2</span></a>
<a class="sourceLine" id="cb18-9" title="9">     <span class="dv">4</span></a>
<a class="sourceLine" id="cb18-10" title="10">     <span class="dv">5</span></a>
<a class="sourceLine" id="cb18-11" title="11">    (<span class="dv">5</span> <span class="kw">rows</span>)</a>
<a class="sourceLine" id="cb18-12" title="12">    ```</a>
<a class="sourceLine" id="cb18-13" title="13"></a>
<a class="sourceLine" id="cb18-14" title="14">    But <span class="kw">with</span> <span class="kw">EXCEPT</span>, a <span class="dt">single</span> occurence <span class="kw">of</span> a <span class="fu">value</span> <span class="cf">for</span> a <span class="kw">in</span> Q wipes <span class="kw">out</span> </a>
<a class="sourceLine" id="cb18-15" title="15">    <span class="op">*</span><span class="kw">all</span><span class="op">*</span> occurences <span class="kw">of</span> it <span class="kw">from</span> P.</a>
<a class="sourceLine" id="cb18-16" title="16">    So <span class="cf">if</span> we <span class="kw">use</span> <span class="kw">EXCEPT</span> <span class="kw">in</span> our <span class="kw">query</span> <span class="kw">from</span> <span class="kw">before</span>, every <span class="dv">1</span> <span class="fu">value</span> <span class="kw">in</span> P</a>
<a class="sourceLine" id="cb18-17" title="17">    <span class="kw">is</span> removed <span class="kw">as</span> a result <span class="kw">of</span> a <span class="dt">single</span> <span class="dv">1</span> <span class="fu">value</span> <span class="kw">in</span> Q.</a>
<a class="sourceLine" id="cb18-18" title="18"></a>
<a class="sourceLine" id="cb18-19" title="19">    ```SQL</a>
<a class="sourceLine" id="cb18-20" title="20">    csc343h<span class="op">-</span>prof<span class="op">=&gt;</span> (<span class="kw">SELECT</span> a <span class="kw">FROM</span> P)</a>
<a class="sourceLine" id="cb18-21" title="21">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> <span class="kw">EXCEPT</span></a>
<a class="sourceLine" id="cb18-22" title="22">    csc343h<span class="op">-</span>prof<span class="op">-&gt;</span> (<span class="kw">SELECT</span> a <span class="kw">FROM</span> Q);</a>
<a class="sourceLine" id="cb18-23" title="23">     a </a>
<a class="sourceLine" id="cb18-24" title="24">    <span class="co">---</span></a>
<a class="sourceLine" id="cb18-25" title="25">     <span class="dv">2</span></a>
<a class="sourceLine" id="cb18-26" title="26">     <span class="dv">4</span>                <span class="op">&lt;</span><span class="co">-- There are no 1s anywhere in this result</span></a>
<a class="sourceLine" id="cb18-27" title="27">     <span class="dv">5</span></a>
<a class="sourceLine" id="cb18-28" title="28">    (<span class="dv">3</span> <span class="kw">rows</span>)</a></code></pre></div>
<p><code>EXCEPT</code> without <code>ALL</code> will always give you a set, because the default for set operators is set semantics. But notice that it is the set you would get from first transforming the result of each subexpression into a set and then applying the difference operator. This is not the same as what you would get from applying the difference using bag semantics and then transofrming the result into a set.</p>
</section>
</body>
</html>
